# Token Bridge UX Overhaul Plan

**Date**: December 25, 2025
**Status**: ğŸš€ Ready to Execute

---

## ğŸ¯ Vision

Transform Token Bridge from a confusing modal-based flow into a clear, progressive onboarding experience with distinct separation between configuration and actions.

---

## ğŸ“‹ Current Problems

1. **Onboarding is a modal** - Feels cramped, not immersive
2. **GitHub import vs config confusion** - "Import from GitHub" suggests one-time action, not persistent config
3. **Sync actions hidden** - Push/Pull not explicitly available as actions
4. **Demo tokens in plugin bundle** - Should be generated by tokens package
5. **Variables detection not working** - Shows "Import Existing Figma Variables" even when none exist
6. **Mixed metaphors** - Settings, actions, and imports all jumbled together

---

## âœ¨ New Experience

### 1ï¸âƒ£ First-Run: Full-Screen Onboarding

**Replaces**: `OnboardingModal.tsx`
**New Component**: `FirstRunOnboarding.tsx`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚         ğŸ¨ Welcome to Token Bridge      â”‚
â”‚                                         â”‚
â”‚    Sync design tokens between Figma    â”‚
â”‚         and your codebase               â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  How would you like to start?     â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  âš¡ Try Demo Tokens               â”‚ â”‚
â”‚  â”‚  Load pre-built tokens to exploreâ”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  ğŸ“¦ Import Existing Variables     â”‚ â”‚
â”‚  â”‚  Convert Figma Variables (23)    â”‚ â”‚ <- Shows count if detected
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  ğŸ“ Import Token File             â”‚ â”‚
â”‚  â”‚  Upload JSON from computer       â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  ğŸ”§ Set Up GitHub Sync            â”‚ â”‚
â”‚  â”‚  Configure repository integrationâ”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  [ Skip - Start Fresh ]           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Features**:

- Full screen takeover (not modal)
- Shows only once (saved to `clientStorage`)
- Detects Figma Variables on mount, shows count
- Each path is clear and actionable
- Can skip to empty state

---

### 2ï¸âƒ£ Main UI: Clear Separation

**Current**: Everything mixed together
**New**: Settings vs Actions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Token Bridge                    âš™ï¸ âš¡  â”‚ <- Settings | Mode Toggle
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  ğŸ“Š Collections (3)                      â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ“ primitive          125 tokens   â”‚ â”‚
â”‚  â”‚ âœ“ semantic-light      87 tokens   â”‚ â”‚
â”‚  â”‚ âœ“ components-dark    243 tokens   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Actions                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚ ğŸ“¤ Exportâ”‚ ğŸ“¥ Importâ”‚ ğŸ”„ Sync â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚  ğŸ”— GitHub: Connected to wylie-dog-ds   â”‚ <- Status indicator
â”‚     Last sync: 5 minutes ago            â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Settings (âš™ï¸ button)**:

- GitHub Configuration
- Format preferences
- Advanced options

**Sync Button Expanded**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”„ Sync          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â†‘ Push to GitHub â”‚
â”‚ â†“ Pull from GitHubâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3ï¸âƒ£ GitHub: Config vs Actions

**GitHub Configuration** (One-time setup):

- Repository details (owner/repo/branch)
- Token path
- Access token
- Sync mode (direct/PR)

**GitHub Actions** (Recurring):

- **Push**: Export selected collections â†’ GitHub
- **Pull**: Import from GitHub â†’ Figma

**Workflow**:

```
First Time:
User clicks "Set Up GitHub Sync" in onboarding
  â†“
SetupWizard appears (existing component)
  â†“
Config saved to clientStorage
  â†“
Main UI shows "GitHub: Connected"

Every Time After:
User clicks "Sync" â†’ Dropdown appears
  â†“
Choose "Push to GitHub" or "Pull from GitHub"
  â†“
Uses saved config (no re-entry needed)
```

---

### 4ï¸âƒ£ Demo Tokens: Build-Time Generation

**Current**: Bundled in plugin
**New**: Generated by tokens package

```bash
# In packages/tokens/package.json
{
  "scripts": {
    "build": "pnpm process-io && node style-dictionary.config.js && pnpm build:demo",
    "build:demo": "node scripts/build-demo-tokens.js"
  }
}
```

**New Script**: `packages/tokens/scripts/build-demo-tokens.js`

```javascript
// Generates demo-tokens.json for Figma plugin
// Hosted at: packages/tokens/dist/demo-tokens.json

import { readFile, writeFile } from "fs/promises";

// Read source tokens
const primitive = JSON.parse(await readFile("io/sync/primitive.json", "utf-8"));

// Create curated subset (25-30 tokens)
const demoTokens = createDemoSubset(primitive);

// Write to dist for plugin to fetch
await writeFile("dist/demo-tokens.json", JSON.stringify(demoTokens, null, 2));
```

**Plugin Fetches**:

```typescript
// In Figma plugin
async function loadDemoTokens() {
  // For local dev: fetch from monorepo
  const response = await fetch("/packages/tokens/dist/demo-tokens.json");

  // For production: could host on CDN or embed small set
  return response.json();
}
```

---

### 5ï¸âƒ£ Figma Variables Detection

**Fix the detection** in onboarding:

```typescript
// In FirstRunOnboarding.tsx
const [variableCount, setVariableCount] = useState(0);
const [hasVariables, setHasVariables] = useState(false);

useEffect(() => {
  // Ask plugin to detect variables
  parent.postMessage({
    pluginMessage: { type: 'detect-figma-variables' }
  }, '*');

  // Listen for result
  const handleMessage = (event: MessageEvent) => {
    if (event.data.pluginMessage?.type === 'figma-variables-detected') {
      const detection = event.data.pluginMessage.detection;
      setHasVariables(detection.hasVariables);
      setVariableCount(detection.totalVariables);
    }
  };

  window.addEventListener('message', handleMessage);
  return () => window.removeEventListener('message', handleMessage);
}, []);

// In render:
<button disabled={!hasVariables}>
  ğŸ“¦ Import Existing Variables
  {hasVariables ? ` (${variableCount})` : ' (None found)'}
</button>
```

---

## ğŸ”¨ Implementation Steps

### Phase 1: Onboarding Overhaul (Today)

1. âœ… Create `FirstRunOnboarding.tsx` - Full screen component
2. âœ… Implement Figma Variables detection on mount
3. âœ… Add onboarding state persistence (clientStorage)
4. âœ… Replace `showOnboarding` modal with full-screen flow
5. âœ… Wire up all 4 paths + skip option

### Phase 2: Main UI Restructure (Today)

6. âœ… Move GitHub to Settings (âš™ï¸ menu)
7. âœ… Add explicit Sync dropdown (Push/Pull)
8. âœ… Add GitHub connection status indicator
9. âœ… Separate Export/Import/Sync as distinct actions

### Phase 3: Demo Tokens Build (Can defer)

10. â¸ï¸ Create `packages/tokens/scripts/build-demo-tokens.js`
11. â¸ï¸ Add to tokens build process
12. â¸ï¸ Update plugin to fetch from tokens package
13. â¸ï¸ Remove demo tokens from plugin bundle

### Phase 4: Polish & Test

14. âœ… Test first-run flow
15. âœ… Test returning user flow (no onboarding)
16. âœ… Test all import paths
17. âœ… Test GitHub config persistence
18. âœ… Test sync actions

---

## ğŸ“ Component Structure (New)

```
App.tsx
â”œâ”€â”€ [showOnboarding] FirstRunOnboarding.tsx  (full screen)
â”‚   â”œâ”€â”€ DemoTokensOption
â”‚   â”œâ”€â”€ ImportVariablesOption
â”‚   â”œâ”€â”€ ImportFileOption
â”‚   â””â”€â”€ GitHubSetupOption
â”‚
â”œâ”€â”€ Main UI (existing, enhanced)
â”‚   â”œâ”€â”€ Header
â”‚   â”‚   â”œâ”€â”€ Title
â”‚   â”‚   â”œâ”€â”€ SettingsButton â†’ SettingsMenu
â”‚   â”‚   â””â”€â”€ ModeToggle
â”‚   â”‚
â”‚   â”œâ”€â”€ Collections List
â”‚   â”‚
â”‚   â”œâ”€â”€ Actions Bar
â”‚   â”‚   â”œâ”€â”€ ExportButton â†’ Export dropdown
â”‚   â”‚   â”œâ”€â”€ ImportButton â†’ Import options
â”‚   â”‚   â””â”€â”€ SyncButton â†’ Push/Pull dropdown
â”‚   â”‚
â”‚   â””â”€â”€ GitHub Status
â”‚       â””â”€â”€ Connection indicator
â”‚
â””â”€â”€ [Settings Menu]
    â”œâ”€â”€ GitHub Configuration â†’ SetupWizard
    â”œâ”€â”€ Format Preferences
    â””â”€â”€ Advanced Options
```

---

## ğŸ¨ Visual Design Notes

**Onboarding**:

- Clean, centered, lots of whitespace
- Large icons for each option
- Subtle hover states
- Progress indicator if multi-step

**Main UI**:

- Clear visual hierarchy
- Actions grouped logically
- GitHub status always visible
- Settings tucked away but accessible

**Sync Actions**:

- Push = â†‘ arrow (upload to GitHub)
- Pull = â†“ arrow (download from GitHub)
- Color coded: Push = blue, Pull = green

---

## âœ… Success Criteria

- [ ] First-run users see full-screen onboarding
- [ ] Returning users skip directly to main UI
- [ ] Variable count shows in onboarding if Variables exist
- [ ] GitHub config is persistent (saved to clientStorage)
- [ ] Push/Pull actions are explicit and clear
- [ ] Settings accessible but not in the way
- [ ] Demo tokens work (even if bundled for now)
- [ ] All import paths functional

---

## ğŸš€ Let's Build This!

Ready to start with Phase 1: Full-screen onboarding component?
