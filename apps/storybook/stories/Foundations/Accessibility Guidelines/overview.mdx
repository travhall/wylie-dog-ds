import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Foundations/Accessibility Guidelines" />

# Accessibility Guidelines

Building accessible interfaces is a core principle of the Wylie Dog Design System. This guide helps you create interfaces that work for everyone.

## Our Commitment

All components in this design system are built with accessibility as a priority:

- **WCAG 2.1 AA compliant** color contrasts
- **Radix UI primitives** with comprehensive ARIA support
- **Full keyboard navigation** for all interactive elements
- **Screen reader compatible** with semantic HTML
- **Tested with axe-core** in Storybook's accessibility addon

---

## Keyboard Navigation

### Essential Keyboard Patterns

All interactive components support keyboard navigation:

<table>
  <thead>
    <tr>
      <th>Key</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Tab</strong></td>
      <td>Move focus forward</td>
    </tr>
    <tr>
      <td><strong>Shift + Tab</strong></td>
      <td>Move focus backward</td>
    </tr>
    <tr>
      <td><strong>Enter</strong></td>
      <td>Activate buttons, links, and submit forms</td>
    </tr>
    <tr>
      <td><strong>Space</strong></td>
      <td>Toggle checkboxes, switches, and buttons</td>
    </tr>
    <tr>
      <td><strong>Arrow Keys</strong></td>
      <td>Navigate menus, tabs, radio groups, and sliders</td>
    </tr>
    <tr>
      <td><strong>Escape</strong></td>
      <td>Close dialogs, popovers, and menus</td>
    </tr>
    <tr>
      <td><strong>Home/End</strong></td>
      <td>Navigate to first/last item in lists</td>
    </tr>
  </tbody>
</table>

### Example: Keyboard-Accessible Form

```tsx
import { Button } from '@wyliedog/ui/button';
import { Input } from '@wyliedog/ui/input';
import { Label } from '@wyliedog/ui/label';
import { Checkbox } from '@wyliedog/ui/checkbox';

export function AccessibleForm() {
  return (
    <form onSubmit={(e) => e.preventDefault()}>
      <div className="space-y-2">
        <Label htmlFor="email">Email Address</Label>
        <Input
          id="email"
          type="email"
          aria-describedby="email-help"
          aria-required="true"
        />
        <p id="email-help" className="text-sm text-(--color-text-secondary)">
          We'll never share your email
        </p>
      </div>

      <div className="flex items-center gap-2">
        <Checkbox id="terms" required />
        <Label htmlFor="terms">
          I agree to the terms and conditions
        </Label>
      </div>

      <Button type="submit">
        Create Account
      </Button>
    </form>
  );
}
```

---

## ARIA Labels & Descriptions

### When to Use ARIA

**Use `aria-label`** when there's no visible text:
```tsx
<Button aria-label="Close dialog">
  <XIcon className="h-4 w-4" />
</Button>
```

**Use `aria-labelledby`** to reference existing text:
```tsx
<div role="region" aria-labelledby="section-title">
  <h2 id="section-title">Account Settings</h2>
  {/* Content */}
</div>
```

**Use `aria-describedby`** for additional context:
```tsx
<Input
  id="password"
  type="password"
  aria-describedby="password-requirements"
/>
<p id="password-requirements" className="text-sm text-(--color-text-secondary)">
  Must be at least 8 characters with a number
</p>
```

### Alert Patterns

Use appropriate alert types for different urgency levels:

```tsx
import { Alert, AlertTitle, AlertDescription } from '@wyliedog/ui/alert';

// Error - High urgency
<Alert variant="destructive">
  <AlertTitle>Error</AlertTitle>
  <AlertDescription>
    Your payment could not be processed
  </AlertDescription>
</Alert>

// Warning - Medium urgency
<Alert variant="warning">
  <AlertTitle>Warning</AlertTitle>
  <AlertDescription>
    Your session will expire in 5 minutes
  </AlertDescription>
</Alert>

// Success - Low urgency
<Alert variant="success">
  <AlertTitle>Success</AlertTitle>
  <AlertDescription>
    Your changes have been saved
  </AlertDescription>
</Alert>
```

---

## Color & Contrast

### WCAG AA Requirements

- **Normal text (< 18pt)**: Minimum 4.5:1 contrast ratio
- **Large text (≥ 18pt)**: Minimum 3:1 contrast ratio
- **UI components**: Minimum 3:1 contrast ratio

### Our Color System

All semantic tokens are designed to meet WCAG AA standards. Use semantic tokens to ensure compliance:

```tsx
// Semantic tokens have tested contrast ratios
<p className="text-(--color-text-primary)">High contrast body text</p>
<p className="text-(--color-text-secondary)">Secondary descriptions</p>

// Status colors pair with their background tokens
<Alert variant="destructive">
  Error message with proper contrast
</Alert>
```

### Don't Rely on Color Alone

Always use multiple indicators:

```tsx
// Good - Icon + color + text
<Alert variant="destructive">
  <AlertCircleIcon className="h-4 w-4" />
  <AlertTitle>Error</AlertTitle>
  <AlertDescription>Something went wrong</AlertDescription>
</Alert>

// Bad - Color only, no supporting context
<p className="text-(--color-text-danger)">Error</p>
```

---

## Focus Management

### Visible Focus Indicators

All components have built-in focus ring styles using the `--color-border-focus` token. These are applied automatically — no extra configuration needed.

### Focus Trapping

Dialogs automatically trap focus using Radix UI primitives:

```tsx
import { Dialog, DialogContent, DialogTitle } from '@wyliedog/ui/dialog';

<Dialog open={isOpen} onOpenChange={setIsOpen}>
  <DialogContent>
    <DialogTitle>Confirm Action</DialogTitle>
    {/* Focus stays within dialog */}
    <Button onClick={() => setIsOpen(false)}>Cancel</Button>
    <Button onClick={handleConfirm}>Confirm</Button>
  </DialogContent>
</Dialog>
```

### Skip Links

Add skip links for keyboard users:

```tsx
export function Layout({ children }) {
  return (
    <>
      <a
        href="#main-content"
        className="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4"
      >
        Skip to main content
      </a>
      <nav>{/* Navigation */}</nav>
      <main id="main-content">{children}</main>
    </>
  );
}
```

---

## Semantic HTML

### Use the Right Elements

```tsx
// Good - Semantic markup
<nav>
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/about">About</a></li>
  </ul>
</nav>

// Bad - Divs for everything
<div>
  <div onClick={goHome}>Home</div>
  <div onClick={goAbout}>About</div>
</div>
```

### Heading Hierarchy

Maintain proper heading levels:

```tsx
// Good - Logical hierarchy
<article>
  <h1>Page Title</h1>
  <section>
    <h2>Section Title</h2>
    <h3>Subsection Title</h3>
  </section>
</article>

// Bad - Skipping levels
<article>
  <h1>Page Title</h1>
  <h4>Section Title</h4> {/* Skipped h2, h3 */}
</article>
```

---

## Testing for Accessibility

### Automated Testing

Use axe-core in your tests:

```tsx
import { render } from '@testing-library/react';
import { axe, toHaveNoViolations } from 'jest-axe';

expect.extend(toHaveNoViolations);

test('button is accessible', async () => {
  const { container } = render(<Button>Click me</Button>);
  const results = await axe(container);
  expect(results).toHaveNoViolations();
});
```

### Manual Testing Checklist

- **Keyboard only**: Can you complete all tasks using only keyboard?
- **Screen reader**: Does it make sense with a screen reader?
- **Zoom**: Is content readable at 200% zoom?
- **Color blindness**: Use color-blind simulators
- **Motion**: Does `prefers-reduced-motion` work?

### Tools

- **axe DevTools** — Browser extension for accessibility audits
- **NVDA / JAWS** — Screen readers for Windows
- **VoiceOver** — Screen reader for macOS
- **Keyboard** — Unplug your mouse!

---

## Common Patterns

### Forms

```tsx
// Always pair labels with inputs
<div>
  <Label htmlFor="username">Username</Label>
  <Input
    id="username"
    aria-invalid={hasError}
    aria-describedby={hasError ? "username-error" : undefined}
  />
  {hasError && (
    <p id="username-error" className="text-(--color-text-danger)">
      Username is required
    </p>
  )}
</div>
```

### Loading States

```tsx
// Announce loading state to screen readers
<div role="status" aria-live="polite">
  {isLoading ? (
    <>
      <Skeleton />
      <span className="sr-only">Loading content...</span>
    </>
  ) : (
    <Content />
  )}
</div>
```

### Modals / Dialogs

```tsx
// Radix dialogs handle focus trapping automatically
<AlertDialog>
  <AlertDialogTrigger>Delete Account</AlertDialogTrigger>
  <AlertDialogContent>
    <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>
    <AlertDialogDescription>
      This action cannot be undone.
    </AlertDialogDescription>
    <AlertDialogAction>Delete</AlertDialogAction>
    <AlertDialogCancel>Cancel</AlertDialogCancel>
  </AlertDialogContent>
</AlertDialog>
```

---

## Best Practices

### Do

- Use semantic HTML elements
- Provide text alternatives for images
- Ensure sufficient color contrast
- Support keyboard navigation
- Test with real assistive technology
- Use ARIA when HTML isn't enough
- Provide clear error messages
- Maintain focus indicators

### Don't

- Use `div` when `button` would work
- Rely on color alone to convey meaning
- Disable focus indicators
- Create keyboard traps
- Use ambiguous link text ("click here")
- Skip heading levels
- Use `aria-label` on non-interactive elements
- Forget to test with keyboard only

---

## External Resources

- [Web Content Accessibility Guidelines (WCAG)](https://www.w3.org/WAI/WCAG21/quickref/)
- [Radix UI Accessibility](https://www.radix-ui.com/primitives/docs/overview/accessibility)
- [The A11Y Project](https://www.a11yproject.com/)
- [WebAIM](https://webaim.org/)
- [axe DevTools](https://www.deque.com/axe/devtools/)

---

Remember: **Accessibility is not a feature — it's a requirement**. Build it in from the start, not as an afterthought.
